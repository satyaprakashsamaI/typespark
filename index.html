<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TypeSpark</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Oswald&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-color: #f4f4f4;
      --text-color: #111;
      --box-color: #fff;
      --toggle-bg: #000;
      --shadow-color: rgba(0,0,0,0.3);
      --correct-glow: rgba(0,255,0,0.7);
      --wrong-glow: rgba(255,0,0,0.7);
      --donate-offset: 230px;
    }
    [data-theme="dark"] {
      --bg-color: #1e1e1e;
      --text-color: #f4f4f4;
      --box-color: #2c2c2c;
      --toggle-bg: #fff;
      --shadow-color: rgba(255,255,255,0.3);
    }
    body {
      font-family: 'Montserrat', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 20px;
      text-align: center;
      transition: background .3s, color .3s;
    }
    header {
      position: relative;
      margin-bottom: 30px;
    }
    h1 {
      font-family: 'Oswald', sans-serif;
      font-size: 48px;
      margin: 0;
    }
    .theme-toggle,
    .donate-btn,
    .analysis-btn {
      position: absolute;
      top: 0;
      padding: 10px 18px;
      border: none;
      border-radius: 20px;
      background: var(--toggle-bg);
      color: var(--bg-color);
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      font-weight: bold;
      cursor: pointer;
      transition: background .3s, color .3s;
    }
    .theme-toggle {
      right: 0;
    }
    .donate-btn {
      right: var(--donate-offset);
    }
    .donate-btn:hover {
      background: linear-gradient(45deg,#FFB3BA,#FFDFBA,#FFFFBA,#BAFFC9,#BAE1FF);
      color: #111;
    }
    .analysis-btn {
      right: 125px;
    }
    .container {
      width: 600px;
      margin: 0 auto;
    }
    .blur {
      filter: blur(4px);
    }
    #textBox {
      width:100%;
      border-radius:12px;
      background:var(--box-color);
      margin-bottom:20px;
      padding:20px;
      box-sizing:border-box;
      text-align:left;
      user-select:none;
      pointer-events:none;
      border:2px solid #ccc;
      box-shadow:0 4px 10px var(--shadow-color);
      min-height:100px;
    }
    [data-theme="dark"] #textBox {
      border:none;
      box-shadow:0 0 8px 3px rgba(255,255,255,0.3);
    }
    #textInner {
      font-size:20px;
      font-weight:bold;
      line-height:1.4;
      opacity:1;
      transition:opacity .3s;
    }
    #inputBox {
      width:100%;
      border-radius:12px;
      background:var(--box-color);
      padding:20px;
      box-sizing:border-box;
      text-align:left;
      font-size:16px;
      line-height:1.4;
      color:var(--text-color);
      border:2px solid #ccc;
      box-shadow:0 4px 10px var(--shadow-color);
      resize:none;
      outline:none;
      min-height:100px;
      margin-bottom:10px;
    }
    [data-theme="dark"] #inputBox {
      border:none;
      box-shadow:0 0 8px 3px rgba(255,255,255,0.3);
    }
    .correct {
      text-shadow:0 0 8px var(--correct-glow);
    }
    .wrong {
      text-shadow:0 0 8px var(--wrong-glow);
    }
    .stats-bar {
      display:flex;
      justify-content:space-between;
      margin-bottom:20px;
      font-size:14px;
    }
    .stats-bar div {
      flex:1;
      text-align:center;
    }
    .stats-bar .left {
      text-align:left;
    }
    .stats-bar .right {
      text-align:right;
    }
    #tryAgainBtn {
      display:none;
      padding:10px 20px;
      font-size:16px;
      border-radius:20px;
      border:none;
      cursor:pointer;
      background:var(--toggle-bg);
      color:var(--bg-color);
      box-shadow:0 2px 6px rgba(0,0,0,0.2);
    }
    #tryAgainBtn:hover {
      background:linear-gradient(45deg,#FFB3BA,#FFDFBA,#FFFFBA,#BAFFC9,#BAE1FF);
      color:#111;
    }
    #modalOverlay {
      display:none;
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.4);
      z-index:1000;
    }
    #analysisModal,
    #donateModal {
      display:none;
      position:fixed;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      background:var(--box-color);
      padding:20px;
      border-radius:12px;
      box-shadow:0 4px 10px var(--shadow-color);
      z-index:1001;
    }
    #analysisModal canvas {
      width:100% !important;
      height:300px !important;
    }
    #closeAnalysis,
    #closeDonate {
      position:absolute;
      top:10px;
      right:10px;
      border:none;
      background:none;
      font-size:18px;
      cursor:pointer;
    }
    .stat-summary {
      margin-top:10px;
      font-weight:bold;
    }
    #resetStats {
      margin-top:15px;
      background:crimson;
      color:#fff;
      border:none;
      padding:8px 14px;
      border-radius:20px;
      cursor:pointer;
    }
  </style>
</head>
<body data-theme="light">
  <header>
    <h1>TypeSpark</h1>
    <button class="analysis-btn" id="analysisBtn">Analysis</button>
    <button class="donate-btn" id="donateBtn">Donate</button>
    <button class="theme-toggle" id="toggleTheme">Dark Theme</button>
  </header>

  <div id="mainContent" class="container">
    <div id="textBox"><div id="textInner"></div></div>
    <textarea id="inputBox" placeholder="Start typing here..." rows="5"></textarea>
    <div class="stats-bar">
      <div class="left">Words: <span id="wordCount">0</span></div>
      <div class="center">Time: <span id="stopwatch">00:00:000</span></div>
      <div class="right">Chars: <span id="charCount">0/0</span></div>
    </div>
    <button id="tryAgainBtn">Generate new paragraph ✨</button>
  </div>

  <div id="modalOverlay"></div>

  <div id="analysisModal">
    <button id="closeAnalysis">✖</button>
    <h2>Last 10 Sessions WPM</h2>
    <canvas id="wpmChart"></canvas>
    <div class="stat-summary" id="summaryStats"></div>
    <button id="resetStats">Reset Stats</button>
  </div>

  <div id="donateModal">
    <button id="closeDonate">✖</button>
    <img 
      src="file:///C:/Users/satya/Desktop/DONATE%20TYPESPARK.png" 
      alt="Donate QR Code" 
      style="max-width:100%; border-radius:12px;" 
    />
  </div>

  <script>
    // Theme toggle
    const toggleBtn = document.getElementById('toggleTheme');
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      toggleBtn.textContent = theme === 'light' ? 'Dark Theme' : 'Light Theme';
      localStorage.setItem('theme', theme);
    }
    applyTheme(localStorage.getItem('theme') || 'light');
    toggleBtn.onclick = () => {
      const next = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      applyTheme(next);
    };

    // Modal logic
    const analysisBtn = document.getElementById('analysisBtn'),
          donateBtn   = document.getElementById('donateBtn'),
          overlay     = document.getElementById('modalOverlay'),
          analysisModal = document.getElementById('analysisModal'),
          donateModal   = document.getElementById('donateModal'),
          closeAnalysis = document.getElementById('closeAnalysis'),
          closeDonate   = document.getElementById('closeDonate'),
          mainContent   = document.getElementById('mainContent');

    function openModal(modal) {
      overlay.style.display = 'block';
      modal.style.display   = 'block';
      mainContent.classList.add('blur');
    }
    function closeModal() {
      overlay.style.display = 'none';
      analysisModal.style.display = 'none';
      donateModal.style.display   = 'none';
      mainContent.classList.remove('blur');
    }

    analysisBtn.onclick = () => openModal(analysisModal);
    donateBtn.onclick   = () => openModal(donateModal);
    closeAnalysis.onclick = closeModal;
    closeDonate.onclick   = closeModal;
    overlay.onclick       = closeModal;

    // Words array
    const words = [
      "apple","banana","cat","dog","elephant","flower","garden","house","ice","jungle",
      "kite","lion","monkey","night","orange","pencil","queen","river","sun","tree",
      "umbrella","violet","window","xylophone","yellow","zebra","book","car","desk","egg",
      "fish","goat","hat","ink","jug","key","lamp","moon","nest","owl",
      "pen","quilt","road","star","table","van","watch","box","yarn","zip"
    ];
    let paragraph = '', startTime = null, timerInt = null, chart;

    // Session storage
    function saveSession(wpm) {
      const s = JSON.parse(localStorage.getItem('sessions') || '[]');
      s.push({ wpm, ts: Date.now() });
      if (s.length > 10) s.shift();
      localStorage.setItem('sessions', JSON.stringify(s));
    }
    function getSessions() {
      return JSON.parse(localStorage.getItem('sessions') || '[]');
    }

    // Chart
    const ctx = document.getElementById('wpmChart').getContext('2d');
    function showAnalysis() {
      const data = getSessions(),
            wpms = data.map(x => x.wpm),
            labels = data.map((_, i) => `#${i+1}`);
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: { labels, datasets: [{ label: 'WPM', data: wpms, borderColor: 'blue' }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
      });
      const summary = document.getElementById('summaryStats');
      if (wpms.length) {
        const avg = (wpms.reduce((a,b) => a+b,0) / wpms.length).toFixed(2),
              hi = Math.max(...wpms),
              lo = Math.min(...wpms);
        summary.textContent = `Average: ${avg} | Highest: ${hi} | Lowest: ${lo}`;
      } else {
        summary.textContent = 'No data';
      }
    }

    // Timer
    function formatTime(ms) {
      const m = String(Math.floor(ms/60000)).padStart(2,'0'),
            s = String(Math.floor((ms%60000)/1000)).padStart(2,'0'),
            f = String(ms%1000).padStart(3,'0');
      return `${m}:${s}:${f}`;
    }
    function startTimer() {
      startTime = Date.now();
      timerInt = setInterval(() => {
        document.getElementById('stopwatch').textContent = formatTime(Date.now()-startTime);
      }, 31);
    }
    function stopTimer() {
      clearInterval(timerInt);
    }

    // Paragraph generation and typing logic
    function generateParagraph() {
      const count = 15 + Math.floor(Math.random()*6), sel = [];
      while (sel.length < count) {
        const w = words[Math.floor(Math.random()*words.length)];
        if (!sel.includes(w) && sel[sel.length-1] !== w) sel.push(w);
      }
      return sel.join(' ');
    }
    function renderParagraph(raw='') {
      document.getElementById('textInner').innerHTML =
        paragraph.split('').map((ch,i) => {
          const cls = i<raw.length ? (raw[i]===ch ? 'correct':'wrong') : '';
          return `<span class="${cls}">${ch}</span>`;
        }).join('');
    }
    function updateCounters(raw='') {
      document.getElementById('wordCount').textContent =
        raw.trim() ? raw.trim().split(/\s+/).length : 0;
      document.getElementById('charCount').textContent =
        `${raw.length}/${paragraph.length}`;
    }
    function showNew() {
      paragraph = generateParagraph();
      const ti = document.getElementById('textInner');
      ti.style.opacity = 0;
      setTimeout(() => {
        renderParagraph();
        ti.style.opacity = 1;
      }, 300);
      const ib = document.getElementById('inputBox');
      ib.value = '';
      ib.disabled = false;
      document.getElementById('tryAgainBtn').style.display = 'none';
      updateCounters('');
      document.getElementById('stopwatch').textContent = '00:00:000';
      if (timerInt) stopTimer();
      startTime = null;
      ib.focus();
    }

    document.getElementById('inputBox').addEventListener('input', e => {
      const raw = e.target.value.slice(0, paragraph.length);
      if (raw.length && startTime === null) startTimer();
      renderParagraph(raw);
      updateCounters(raw);
      if (raw.length === paragraph.length) {
        e.target.disabled = true;
        stopTimer();
        const elapsed = Date.now() - startTime;
        const correctWords = paragraph.split(' ')
          .filter((w,i) => w === raw.trim().split(/\s+/)[i]).length;
        const wpm = Math.round(correctWords / (elapsed/1000) * 60);
        const correctChars = [...raw].filter((c,i)=>c===paragraph[i]).length;
        const acc = (correctChars / paragraph.length) * 100;
        saveSession(wpm);
        showAnalysis();
        const note = acc===100
          ? 'Perfect! Excellent work!'
          : acc>=90
            ? "Great job! You're very close!"
            : 'Keep practicing, you can improve!';
        const ti = document.getElementById('textInner');
        ti.style.opacity = 0;
        setTimeout(() => {
          ti.innerHTML = `<p><strong>${note}</strong></p>
            <p><strong>Time:</strong> ${formatTime(elapsed)}</p>
            <p><strong>WPM:</strong> ${wpm}</p>
            <p><strong>Accuracy:</strong> ${acc.toFixed(2)}%</p>`;
          ti.style.opacity = 1;
          document.getElementById('tryAgainBtn').style.display = 'inline-block';
        }, 300);
      }
    });

    document.getElementById('tryAgainBtn').onclick = showNew;
    document.getElementById('resetStats').onclick = () => {
      localStorage.removeItem('sessions');
      showAnalysis();
    };

    // Initialize
    showNew();
  </script>
</body>
</html>

